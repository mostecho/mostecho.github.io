---
title: EasyXå›¾å½¢åº“æ¸¸æˆå¼€å‘ç¬¬äºŒå¤©
series: EasyXå›¾å½¢åº“æ¸¸æˆå¼€å‘
date: 2025-04-27 23:08:33
tags:
  - C++
  - æ¸¸æˆ
  - EasyX
categories:
  - C++
---

# EasyXå›¾å½¢åº“æ¸¸æˆå¼€å‘ç¬¬äºŒå¤©

## ä»Šæ—¥ç›®æ ‡

æ˜¨å¤©å·²ç»å®žçŽ°äº†å›¾å½¢ä¸»ç•Œé¢ï¼Œä»Šå¤©è¦åšçš„æ˜¯é¼ æ ‡æ£€æµ‹åŠŸèƒ½å’Œåœºæ™¯åˆ‡æ¢ï¼Œè®©é¼ æ ‡åœ¨ç‚¹å‡»å›¾ç‰‡åŽèƒ½è§¦å‘å¼€å§‹æˆ–è€…é€€å‡º



## é¼ æ ‡æ£€æµ‹

é¦–å…ˆè¦ä½¿ç”¨ExMessageå…ˆå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ç»“æž„ä½“



![å¾®ä¿¡å›¾ç‰‡_20250427173757.png](https://bu.dusays.com/2025/04/27/680dfafbca885.png)



è¿™ä¸ªç»“æž„ä½“ç”¨äºŽä¿å­˜é¼ æ ‡æ¶ˆæ¯ï¼Œå®šä¹‰å¦‚ä¸‹ï¼ˆä¸ç”¨å†å®šä¹‰ï¼‰ï¼š

```cpp
struct ExMessage
{
	USHORT message;					// æ¶ˆæ¯æ ‡è¯†
	union
	{
		// é¼ æ ‡æ¶ˆæ¯çš„æ•°æ®
		struct
		{
			bool ctrl		:1;		// Ctrl é”®æ˜¯å¦æŒ‰ä¸‹
			bool shift		:1;		// Shift é”®æ˜¯å¦æŒ‰ä¸‹
			bool lbutton	:1;		// é¼ æ ‡å·¦é”®æ˜¯å¦æŒ‰ä¸‹
			bool mbutton	:1;		// é¼ æ ‡ä¸­é”®æ˜¯å¦æŒ‰ä¸‹
			bool rbutton	:1;		// é¼ æ ‡å³é”®
			short x;				// é¼ æ ‡çš„ x åæ ‡
			short y;				// é¼ æ ‡çš„ y åæ ‡
			short wheel;			// é¼ æ ‡æ»šè½®æ»šåŠ¨å€¼ï¼Œä¸º 120 çš„å€æ•°
		};

		// æŒ‰é”®æ¶ˆæ¯çš„æ•°æ®
		struct
		{
			BYTE vkcode;			// æŒ‰é”®çš„è™šæ‹Ÿé”®ç 
			BYTE scancode;			// æŒ‰é”®çš„æ‰«æç ï¼ˆä¾èµ–äºŽ OEMï¼‰
			bool extended	:1;		// æŒ‰é”®æ˜¯å¦æ˜¯æ‰©å±•é”®
			bool prevdown	:1;		// æŒ‰é”®çš„å‰ä¸€ä¸ªçŠ¶æ€æ˜¯å¦æŒ‰ä¸‹
		};

		// å­—ç¬¦æ¶ˆæ¯çš„æ•°æ®
		TCHAR ch;

		// çª—å£æ¶ˆæ¯çš„æ•°æ®
		struct
		{
			WPARAM wParam;
			LPARAM lParam;
		};
	};
};
```



ç„¶åŽä½¿ç”¨peekmessageèŽ·å–é¼ æ ‡æ¶ˆæ¯å¹¶è¿”å›ž

![å¾®ä¿¡å›¾ç‰‡_20250427173642.png](https://bu.dusays.com/2025/04/27/680dfab1c7938.png)



```cpp
initgraph(WIDTH,HEIGTH);  //åˆ›å»ºçª—å£ 1280x720
startloadImg();           //åŠ è½½ä¸»ç•Œé¢

while (true) {
    ExMessage msg={ 0 };   //å®šä¹‰æ¶ˆæ¯ç»“æž„ä½“å˜é‡
    while (peekmessage(&msg,EX_MOUSE)){   //å¤„ç†æ¶ˆæ¯ï¼Œä¸æ–­åœ°èŽ·å–EX_MOUSEï¼ˆé¼ æ ‡æ¶ˆæ¯ï¼‰
    	startupScene(&msg);  //åœºæ™¯åˆ‡æ¢
    }
}
```



## åœºæ™¯åˆ‡æ¢

éœ€è¦å…ˆå®šä¹‰ä¸€ä¸ªç”¨äºŽåˆ‡æ¢åœºæ™¯çš„å‡½æ•°ï¼Œå®žçŽ°çš„åŠŸèƒ½æ˜¯æ£€æµ‹é¼ æ ‡ä½ç½®å¹¶å¯¹é¼ æ ‡æ“ä½œåšå‡ºåé¦ˆ

æ‰€ä»¥æˆ‘å…ˆå®šä¹‰ä¸€ä¸ªæžšä¸¾ç±»åž‹[C enum(æžšä¸¾) | èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/cprogramming/c-enum.html)

> æžšä¸¾æ˜¯ C è¯­è¨€ä¸­çš„ä¸€ç§åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œç”¨äºŽå®šä¹‰ä¸€ç»„å…·æœ‰ç¦»æ•£å€¼çš„å¸¸é‡ï¼Œå®ƒå¯ä»¥è®©æ•°æ®æ›´ç®€æ´ï¼Œæ›´æ˜“è¯»ã€‚æžšä¸¾ç±»åž‹é€šå¸¸ç”¨äºŽä¸ºç¨‹åºä¸­çš„ä¸€ç»„ç›¸å…³çš„å¸¸é‡å–åå­—ï¼Œä»¥ä¾¿äºŽç¨‹åºçš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚

æžšä¸¾ç±»åž‹æ˜¯é»˜è®¤ç¬¬ä¸€ä¸ªæžšä¸¾æˆå‘˜çš„é»˜è®¤å€¼ä¸ºæ•´åž‹çš„ 0ï¼ŒåŽç»­æžšä¸¾æˆå‘˜çš„å€¼åœ¨å‰ä¸€ä¸ªæˆå‘˜ä¸ŠåŠ  1ã€‚

æˆ‘ä»¬åœ¨è¿™ä¸ªå®žä¾‹ä¸­æŠŠç¬¬ä¸€ä¸ªæžšä¸¾æˆå‘˜çš„å€¼å®šä¹‰ä¸º 1ï¼Œç¬¬äºŒä¸ªå°±ä¸º 2ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚

```cpp
enum MenuOp
{
    Start=1,     //å¼€å§‹æŒ‰é’®ï¼Œè¿›å…¥å…³å¡ã€‚
    Quit,       //ç»“æŸæŒ‰é’®ï¼Œé€€å‡ºæ¸¸æˆã€‚
    Home       //ä¸»ç•Œé¢
};
```



{% note danger simple %}

è¯·æ³¨æ„ä¸€å®šè¦å¼„æ¸…æ¥šå›¾ç‰‡åœ¨çª—å£ä¸­çš„é€»è¾‘åæ ‡ï¼Œä¸ç„¶å°±ä¼šåƒæˆ‘ä¸€æ ·ç‚¹å›¾ç‰‡æ²¡ååº”ï¼Œå·®ç‚¹ä»¥ä¸ºå†™é”™äº†ifçš„åˆ¤æ–­è¯­å¥

è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä¹Ÿæ²¡å¼„æ‡‚ï¼Œæˆ‘çš„ç”µè„‘åˆ†è¾¨çŽ‡æ˜¯1920x1080ï¼Œè€ŒåŒå­¦çš„ç”µè„‘åˆ†è¾¨çŽ‡æ˜¯2560x1600ï¼Œ

ä¸‹é¢è¿™è¡Œä»£ç åœ¨æˆ‘ç”µè„‘ä¸Šè·‘ç‰©ç†çª—å£å¤§å°ä¸º1280x720ï¼Œè€Œåœ¨åŒå­¦ç”µè„‘ä¸Šè·‘åˆ™ä¸º1920x1080ï¼Œ

ä½†æ˜¯å…¶å®žä¹Ÿæ²¡å•¥ï¼Œå› ä¸ºä¸‹é¢åœºæ™¯åˆ‡æ¢ä»£ç åœ¨ä¸¤è¾¹çš„ç”µè„‘ä¸Šéƒ½èƒ½æ­£ç¡®åˆ¤æ–­ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†æ˜¯èƒ½è·‘å°±è¡ŒðŸ‘ðŸ»

{% endnote %}

```cpp
initgraph(WIDTH,HEIGTH);  //åˆ›å»ºçª—å£ 1280x720
```



æˆ‘ä»¬è¿˜éœ€è¦å‡†å¤‡ä¸€å¼ å›¾ç‰‡ç”¨äºŽåœºæ™¯åˆ‡æ¢åŽçš„æ–°å›¾ç‰‡ç»˜åˆ¶ï¼Œå¹¶åœ¨startloadImg()é‡ŒåŠ ä¸Šä¸€è¡Œ

```cpp
loadimage(&gamebk, _T("image/gamebk.jpg"),1280,720); //åŽé¢çš„æ˜¯ç”¨äºŽå›¾ç‰‡æ‹‰ä¼¸è¦†ç›–æ•´ä¸ªçª—å£
```



ä¸‹é¢è¿™å—ä»£ç æ˜¯åœºæ™¯åˆ‡æ¢ä»£ç ï¼Œé‡Œé¢çš„isInRect(msg,x,y,w,h)è¿™ä¸ªæ˜¯ç”¨äºŽä¸‹ä¸€æ­¥åˆ¤æ–­æ˜¯å¦é¼ æ ‡ç‚¹å‡»å›¾ç‰‡

{% note info simple %}

å­¦ä¼šä½¿ç”¨ç»ˆç«¯ï¼Œå¯ä»¥åœ¨ifåˆ¤æ–­è¯­å¥å†…åŠ ä¸€å¥æ–‡å­—è¾“å‡ºï¼Œçœ‹çœ‹æ˜¯å¦æ¡ä»¶æ˜¯å¦æ‰§è¡Œ

{% endnote %}




```cpp
void startupScene(ExMessage *msg)
{
    //é¼ æ ‡å·¦è¾¹ç‚¹å‡»åˆ‡æ¢åœºæ™¯
    if (menuState==Home)
    {
        if(isInRect(msg,550,310,170,50)&&msg->message == WM_LBUTTONUP)  //æ ¹æ®ç‰©ç†çª—å£å¤§å°ç¼–å†™åæ ‡
        {
            menuState=Start;  //å¼€å§‹æ¸¸æˆï¼Œç»˜åˆ¶æ–°å›¾åƒ
            putimage( 0,0,&gamebk);
        }
        else if (isInRect(msg,550,410,170,50)&&msg->message == WM_LBUTTONUP)
        {
            menuState=Quit; //é€€å‡ºæ¸¸æˆï¼Œå…³é—­çª—å£
            exit(0);
        }
    }
}
```

![å¾®ä¿¡å›¾ç‰‡_20250426171624.png](https://bu.dusays.com/2025/04/26/680ca469010a2.png)



## åˆ¤æ–­æ˜¯å¦ç‚¹å‡»

æˆ‘ä»¬éœ€è¦åˆ¤æ–­é¼ æ ‡æ˜¯å¦åœ¨å›¾ç‰‡ä¸Šå¹¶ä¸”ç‚¹å‡»å›¾ç‰‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æˆ‘ä»¬éœ€è¦æ£€æµ‹å·¦é”®ç‚¹å‡»ï¼ˆæŒ‰ç†æ¥è¯´åº”è¯¥æ£€æµ‹å·¦é”®æ˜¯å¦æ¾å¼€ï¼Œæ‰€ä»¥æˆ‘å†™çš„æ˜¯WM_LBUTTONUPï¼Œæ£€æµ‹å·¦é”®æ¾å¼€ï¼‰ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯å¸ƒå°”ç±»åž‹boolï¼Œ[C è¯­è¨€çš„å¸ƒå°”ç±»åž‹(true ä¸Ž false) | èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/w3cnote/c-bool-true-false.html)

è¿™æ ·å¯ä»¥åˆ¤æ–­é¼ æ ‡å·¦é”®çš„æ¾å¼€æ˜¯å¦åœ¨å›¾ç‰‡ä¸Šï¼Œå¦‚æžœæ˜¯trueè·³è½¬ä¸‹ä¸€ä¸ªç•Œé¢ï¼Œå¦‚æžœæ˜¯falseå°±ä¿æŒå½“å‰ç•Œé¢ã€‚

```cpp
bool isInRect(ExMessage *msg, int x, int y, int w, int h)
{
    if (msg->x>x&&msg->x<w+x&&msg->y>y&&msg->y<h+y)   //åˆ¤æ–­é¼ æ ‡æ˜¯å¦åœ¨å›¾ç‰‡ä¸Š
        return true;
    else
        return false;
}
```













